# -*- coding: utf-8 -*-
"""RAG-Masters.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1V_CNtEYbf_Bl6n5WNJ0iwHfEFBU4xsTp
"""

!pip install langchain

!pip install openai

!pip install weaviate-client

import os

# Defina a sua chave da API do OpenAI
openai_api_key = ""

# Configure a vari√°vel de ambiente OPENAI_API_KEY
os.environ["OPENAI_API_KEY"] = openai_api_key

#loading extra data
import requests
from langchain.document_loaders import TextLoader

#get the data from a repo
url = "https://github.com/nathaliacauas/masters/blob/main/Chef'sHat.txt"
res = requests.get(url)
with open("ChefsHat.txt", "w") as f:
    f.write(res.text)

loader = TextLoader('./ChefsHat.txt')
documents = loader.load()

from langchain.text_splitter import CharacterTextSplitter
text_splitter = CharacterTextSplitter(chunk_size=500, chunk_overlap=50)
chunks = text_splitter.split_documents(documents)

!pip install tiktoken

from langchain.embeddings import OpenAIEmbeddings
from langchain.vectorstores import Weaviate
import weaviate
from weaviate.embedded import EmbeddedOptions

client = weaviate.Client(
  embedded_options = EmbeddedOptions()
)

vectorstore = Weaviate.from_documents(
    client = client,
    documents = chunks,
    embedding = OpenAIEmbeddings(),
    by_text = False
)

retriever = vectorstore.as_retriever()

from langchain.prompts import ChatPromptTemplate

template = """You are a sports commentator. Use the following pieces of retrieved context to elaborate exciting comments about the player's moves.
Keep the answer small and concise.
Question: {question}
Context: {context}
Answer:
"""
prompt = ChatPromptTemplate.from_template(template)

print(prompt)

from langchain.chat_models import ChatOpenAI
from langchain.schema.runnable import RunnablePassthrough
from langchain.schema.output_parser import StrOutputParser

llm = ChatOpenAI(model_name="gpt-3.5-turbo", temperature=0)

rag_chain = (
    {"context": retriever,  "question": RunnablePassthrough()}
    | prompt
    | llm
    | StrOutputParser()
)

def new_move (move):
  query = move
  return rag_chain.invoke(query)

new_move("Starting new Episode:1 20240314_02:02:01.187718, Players :['RANDOM_01', 'RANDOM_02', 'RANDOM_03', 'RANDOM_04'] 20240314_02:02:01.188244Stop Criteria :9, Match Numbedr 1.000000 Starts, 20240314_02:02:01.194928 Deck: [3, 8, 11, 10, 2, 9, 6, 8, 11, 12, 10, 9, 10, 11, 9, 11, 10, 3, 7, 3, 11, 11, 11, 11, 5, 8, 8, 10, 5, 9, 10, 11, 1, 8, 7, 5, 9, 6, 10, 7, 2, 10, 7, 7, 5, 6, 8, 7, 6, 11, 4, 8, 9, 5, 9, 9, 4, 4, 10, 7, 6, 4, 6, 11, 8, 10, 12, 9], 20240314_02:02:01.195411 Player 0:[2, 3, 6, 8, 8, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 11, 12], 20240314_02:02:01.195873 Player 1:[1, 3, 3, 5, 5, 7, 8, 8, 8, 9, 10, 10, 11, 11, 11, 11, 11],20240314_02:02:01.196341 Player 2:[2, 4, 5, 5, 6, 6, 6, 7, 7, 7, 7, 7, 8, 9, 10, 10, 11],20240314_02:02:01.196800 Player 3:[4, 4, 4, 5, 6, 6, 7, 8, 8, 9, 9, 9, 9, 10, 10, 11, 12], Round:1, 20240314_02:02:01.199410  Player 3  RANDOM_04, 20240314_02:02:01.200033  Player Hand: [0, 4, 4, 4, 5, 6, 6, 7, 8, 8, 9, 9, 9, 9, 10, 10, 12], 20240314_02:02:01.200524  Board Before: [13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.200984  Action: ('DISCARD', [11]), 20240314_02:02:01.201475  Board After: [11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.205370  Player 0  RANDOM_01, 20240314_02:02:01.205895  Player Hand: [0, 0, 0, 2, 3, 6, 8, 8, 9, 9, 9, 10, 11, 11, 11, 11, 12],20240314_02:02:01.206420  Board Before: [11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.206909  Action: ('DISCARD', [10, 10, 10]), 20240314_02:02:01.207406  Board After: [10, 10, 10, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.210467  Player 1  RANDOM_02, 20240314_02:02:01.210956  Player Hand: [1, 3, 3, 5, 5, 7, 8, 8, 8, 9, 10, 10, 11, 11, 11, 11, 11], 20240314_02:02:01.211469  Board Before: [10, 10, 10, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.211925  Action: ('PASS', [0]), 20240314_02:02:01.212393  Board After: [10, 10, 10, 0, 0, 0, 0, 0, 0, 0, 0],20240314_02:02:01.215326  Player 2  RANDOM_03, ,20240314_02:02:01.215898  Player Hand: [0, 0, 0, 0, 2, 4, 5, 5, 6, 6, 6, 7, 8, 9, 10, 10, 11], 20240314_02:02:01.216388  Board Before: [10, 10, 10, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.216849  Action: ('DISCARD', [7, 7, 7, 7]), 20240314_02:02:01.217328  Board After: [7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.220317  Player 3  RANDOM_04, 20240314_02:02:01.220840  Player Hand: [0, 4, 4, 4, 5, 6, 6, 7, 8, 8, 9, 9, 9, 9, 10, 10, 12], 20240314_02:02:01.221343  Board Before: [7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.221797  Action: ('PASS', [0]), 20240314_02:02:01.222280  Board After: [7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.225286  Player 0  RANDOM_01, 20240314_02:02:01.225820  Player Hand: [0, 0, 0, 2, 3, 6, 8, 8, 9, 9, 9, 10, 11, 11, 11, 11, 12], 20240314_02:02:01.226317  Board Before: [7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.226767  Action: ('PASS', [0]), 20240314_02:02:01.227248  Board After: [7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0],Pizza ready!!!")

new_move("Round:2, 20240314_02:02:01.234723  Player 2  RANDOM_03, 20240314_02:02:01.235312  Player Hand: [0, 0, 0, 0, 0, 0, 2, 4, 5, 5, 6, 7, 8, 9, 10, 10, 11], 20240314_02:02:01.235797  Board Before: [13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.236287  Action: ('DISCARD', [6, 6]), 20240314_02:02:01.236766  Board After: [6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.239779  Player 3  RANDOM_04, 20240314_02:02:01.240348  Player Hand: [0, 0, 0, 0, 0, 5, 6, 6, 7, 8, 8, 9, 9, 9, 9, 10, 10], 20240314_02:02:01.240830  Board Before: [6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.241320  Action: ('DISCARD', [4, 4, 4, 12]), 20240314_02:02:01.241790  Board After: [4, 4, 4, 12, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.244721  Player 0  RANDOM_01, 20240314_02:02:01.245252  Player Hand: [0, 0, 0, 2, 3, 6, 8, 8, 9, 9, 9, 10, 11, 11, 11, 11, 12], 20240314_02:02:01.245726  Board Before: [4, 4, 4, 12, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.246218  Action: ('PASS', [0]), 20240314_02:02:01.246705  Board After: [4, 4, 4, 12, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.249672  Player 1  RANDOM_02, 20240314_02:02:01.250248  Player Hand: [1, 3, 3, 5, 5, 7, 8, 8, 8, 9, 10, 10, 11, 11, 11, 11, 11], 20240314_02:02:01.250728  Board Before: [4, 4, 4, 12, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.251224  Action: ('PASS', [0]), 20240314_02:02:01.251687  Board After: [4, 4, 4, 12, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.254653  Player 2  RANDOM_03, 20240314_02:02:01.255260  Player Hand: [0, 0, 0, 0, 0, 0, 2, 4, 5, 5, 6, 7, 8, 9, 10, 10, 11], 20240314_02:02:01.255773  Board Before: [4, 4, 4, 12, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.256281  Action: ('PASS', [0]), 20240314_02:02:01.256745  Board After: [4, 4, 4, 12, 0, 0, 0, 0, 0, 0, 0], Pizza ready!!!")

new_move("Round:3, 20240314_02:02:01.263598  Player 3  RANDOM_04, 20240314_02:02:01.264159  Player Hand: [0, 0, 0, 0, 0, 0, 5, 6, 6, 7, 8, 9, 9, 9, 9, 10, 10], 20240314_02:02:01.264640  Board Before: [13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.265111  Action: ('DISCARD', [8]), 20240314_02:02:01.265591  Board After: [8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.268617  Player 0  RANDOM_01, 20240314_02:02:01.269197  Player Hand: [0, 0, 0, 0, 0, 2, 6, 8, 8, 9, 9, 9, 10, 11, 11, 11, 11], 20240314_02:02:01.269323  Board Before: [8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.269390  Action: ('DISCARD', [3, 12]), 20240314_02:02:01.269464  Board After: [3, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.274786  Player 1  RANDOM_02, 20240314_02:02:01.275572  Player Hand: [1, 3, 3, 5, 5, 7, 8, 8, 8, 9, 10, 10, 11, 11, 11, 11, 11], 20240314_02:02:01.276060  Board Before: [3, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.276554  Action: ('PASS', [0]), 20240314_02:02:01.276658  Board After: [3, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.280168  Player 2  RANDOM_03, 20240314_02:02:01.280838  Player Hand: [0, 0, 0, 0, 0, 0, 2, 4, 5, 5, 6, 7, 8, 9, 10, 10, 11], 20240314_02:02:01.280948  Board Before: [3, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.281037  Action: ('PASS', [0]), 20240314_02:02:01.281107  Board After: [3, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.285635  Player 3  RANDOM_04, 20240314_02:02:01.285752  Player Hand: [0, 0, 0, 0, 0, 0, 5, 6, 6, 7, 8, 9, 9, 9, 9, 10, 10], 20240314_02:02:01.285820  Board Before: [3, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.285884  Action: ('PASS', [0]), 20240314_02:02:01.285945  Board After: [3, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0],Pizza ready!!!")

new_move("Round:4, 20240314_02:02:01.294564  Player 0  RANDOM_01, 20240314_02:02:01.295148  Player Hand: [0, 0, 0, 0, 0, 0, 0, 2, 6, 8, 8, 9, 9, 9, 10, 11, 11], 20240314_02:02:01.295265  Board Before: [13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.295341  Action: ('DISCARD', [11, 11]), 20240314_02:02:01.295406  Board After: [11, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.300386  Player 1  RANDOM_02, 20240314_02:02:01.300917  Player Hand: [1, 3, 3, 5, 5, 7, 8, 8, 8, 9, 10, 10, 11, 11, 11, 11, 11], 20240314_02:02:01.301421  Board Before: [11, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.301893  Action: ('PASS', [0]), 20240314_02:02:01.302382  Board After: [11, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.306115  Player 2  RANDOM_03, 20240314_02:02:01.306938  Player Hand: [0, 0, 0, 0, 0, 0, 2, 4, 5, 5, 6, 7, 8, 9, 10, 10, 11], 20240314_02:02:01.307462  Board Before: [11, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.307931  Action: ('PASS', [0]), 20240314_02:02:01.308404  Board After: [11, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.311963  Player 3  RANDOM_04, 20240314_02:02:01.312501  Player Hand: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 6, 6, 7, 8, 10, 10], 20240314_02:02:01.313016  Board Before: [11, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.313477  Action: ('DISCARD', [9, 9, 9, 9]), 20240314_02:02:01.313945  Board After: [9, 9, 9, 9, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.317101  Player 0  RANDOM_01, 20240314_02:02:01.317651  Player Hand: [0, 0, 0, 0, 0, 0, 0, 2, 6, 8, 8, 9, 9, 9, 10, 11, 11], 20240314_02:02:01.318153  Board Before: [9, 9, 9, 9, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.318623  Action: ('PASS', [0]), 20240314_02:02:01.319101  Board After: [9, 9, 9, 9, 0, 0, 0, 0, 0, 0, 0], Pizza ready!!!")

new_move("Round:5, 20240314_02:02:01.326374 Player 3 RANDOM_04, 20240314_02:02:01.326512 Player Hand: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 6, 6, 7, 10, 10], 20240314_02:02:01.326580  Board Before: [13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.327771  Action: ('DISCARD', [8]), 20240314_02:02:01.328356  Board After: [8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.332175  Player 0  RANDOM_01, 20240314_02:02:01.332729  Player Hand: [0, 0, 0, 0, 0, 0, 0, 0, 2, 8, 8, 9, 9, 9, 10, 11, 11], 20240314_02:02:01.333234  Board Before: [8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.333699  Action: ('DISCARD', [6]), 20240314_02:02:01.334199  Board After: [6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.337156  Player 1  RANDOM_02, 20240314_02:02:01.337662  Player Hand: [0, 3, 3, 5, 5, 7, 8, 8, 8, 9, 10, 10, 11, 11, 11, 11, 11], 20240314_02:02:01.338156  Board Before: [6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.338621  Action: ('DISCARD', [1]), 20240314_02:02:01.339103  Board After: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.342589  Player 2  RANDOM_03, 20240314_02:02:01.343163  Player Hand: [0, 0, 0, 0, 0, 0, 2, 4, 5, 5, 6, 7, 8, 9, 10, 10, 11], 20240314_02:02:01.343651  Board Before: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.344145  Action: ('PASS', [0]), 20240314_02:02:01.344611  Board After: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.348240  Player 3  RANDOM_04, 20240314_02:02:01.348843  Player Hand: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 6, 6, 7, 10, 10], 20240314_02:02:01.349399  Board Before: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.349928  Action: ('PASS', [0]), 20240314_02:02:01.350464  Board After: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.355311  Player 0  RANDOM_01, 20240314_02:02:01.355441  Player Hand: [0, 0, 0, 0, 0, 0, 0, 0, 2, 8, 8, 9, 9, 9, 10, 11, 11], 20240314_02:02:01.355525 Board Before: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 20240314_02:02:01.355600 Action: ('PASS', [0]), 20240314_02:02:01.355676 Board After: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], Pizza ready!!!")

new_move("crie uma introdu√ß√£o para um jogo, considerando a presen√ßa dos jogadores: player 0, player 1, player 2, player 3")